name: CD - Deploy no Argo

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Tag para deploy (ex: v1.2.0)'
        required: true

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Atualizar imagem no CronWorkflow do Argo
        run: |
          kubectl patch cronworkflow spring-batch-scheduled -n argo \
            --type='json' \
            -p='[{"op": "replace", "path": "/spec/workflowSpec/templates/0/container/image", "value": "${{ secrets.DOCKERHUB_USERNAME }}/spring-batch-lab:${{ github.event.inputs.tag }}"}]'
